@model DAL.ViewModels.MenuItemsViewModel;

<div class="table-responsive  mt-3">
    <table class="table " id="myTable">
        <thead>
            <tr>
                <th>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault">
                        <label class="form-check-label" for="flexCheckDefault">
                            <div class="ms-2">Name</div>
                        </label>
                    </div>
                </th>
                <th>Item Type</th>
                <th>Rate</th>
                <th>Quantity</th>
                <th>Available</th>
                <th>Actions</th>
            </tr>
        </thead>

        <tbody>
            @foreach(var item in Model.items){
            <tr>
                <td>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault">
                        <label class="form-check-label" for="flexCheckDefault">
                            <div class="d-flex   align-items-center w-auto p-0 ">
                                <img src="images/dining-menu.png" alt="Image"
                                    class="img-fluid me-2 ms-2" style="font: 10px; height: 25px;">
                                <div style="word-wrap: break-word;">@item.Name
                                </div>
                            </div>
                        </label>
                    </div>
                </td>
                <td>
                    <img src="images/icons/veg-icon.svg" alt="Image" class="img-fluid me-2 ms-2"
                        style="font: 10px; height: 25px;">
                </td>
                <td>
                    @item.Rate
                </td>
                <td>
                    @item.Quantity
                </td>
                 <td>
                <div class="form-check form-switch ">
                  <input class="form-check-input can-add-edit" type="checkbox" id="can-add-edit" name="darkmode"   asp-for="@item.IsAvailable" >
                </div>

              </td>
                <td>
                    <div class="d-flex align-items-center ">
                        <i class="fa-solid fa-pen me-3 ms-3"></i>

                        <i class="fa-solid fa-trash" data-bs-toggle="modal"
                            data-bs-target="#deleteItem"></i>
                    </div>
                </td>
            </tr>
             }
        </tbody>
    </table>
     <div class="row text-end">
      <div class="d-flex flex-col justify-content-end mb-2">
      <form method="get" id="pageSizeForm" >
    <label for="pageSize">Records per page:</label>
    <select id="pageSize" name="pageSize" onchange="fetch(@Model.PageNumber,@Model.PageSize)">
        <option value="2" >2</option>      
        <option value="5" >5</option>      
        <option value="10" >10</option>      
        <option value="15" >15</option>      
    </select>
  </form>
   <div class="ms-2">
   @if(@Model.PageNumber>1)
   {
    <a onclick="fetch(@Model.PageNumber-1,@Model.PageSize)" style="cursor:pointer;color:blue;">Previous</a>
   }
   Page @Model.PageNumber of @Model.TotalPages

   @if(@Model.PageNumber<@Model.TotalPages)
   {
    <a onclick="fetch(@Model.PageNumber+1,@Model.PageSize)" style="cursor:pointer;color:blue;">Next</a>
   }
   </div>
  </div>
   </div>
</div>
 <div class="modal" id="addItem">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" style="color:rgba(9, 9, 172, 0.692) ;">Add New Menu Item</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form asp-action="AddItem" asp-controller="Menu" method="POST">
                <div class="modal-body "> 
                    <div class="container-fluid">
                    <div class="row">
                        <div class="col-10 col-md-9 col-sm-12">
                            <div class="row">
                                <div class="col col-md-6">
                                    <div class="form-floating mb-3">
                                    <select class="form-select" id="catgory" name="catgory"  asp-for="@Model.item.CategoryId" onchange="fetchModifiers(this)">
                                    @foreach(var category in Model.categories){
                                    <option value="@category.CategoryId">@category.Name</option>
                                    }
                                    </select>
                                    <label for="category" class="form-label">Category</label>
                                    </div>
                                </div>
                                <div class="col col-md-6">
                                    <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="Name" name="Name" placeholder="Name" asp-for="@Model.item.Name">
                                    <label for="name">Name</label>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col col-md-3">
                                    <div class="form-floating mb-3">
                                    <select class="form-select" id="itemType" name="itemType" asp-for="@Model.item.ItemType" >
                                    <option value="">Item Type</option>
                                    <option value="veg">Vegetarian</option>
                                    <option value="non-veg">Non-Vegeterian</option>
                                    <option value="vegan">Vegan</option>
                                    </select>
                                    <label for="category" class="form-label">Item Type</label>
                                    </div>
                                </div>
                                <div class="col col-md-3">
                                    <div class="form-floating mb-3">
                                    <input type="number" class="form-control" id="Rate" name="Rate" placeholder="Rate" asp-for="@Model.item.Rate">
                                    <label for="Rate">Rate</label>
                                    </div>
                                </div>
                                <div class="col col-md-3">
                                    <div class="form-floating mb-3">
                                    <input type="number" class="form-control" id="Quantity" name="Quantity" placeholder="Quantity" asp-for="@Model.item.Quantity">
                                    <label for="Quantity">Quantity</label>
                                    </div>
                                </div>
                                 <div class="col col-md-3">
                                    <div class="form-floating mb-3">
                                    <select class="form-select" id="unit" name="unit"  asp-for="@Model.item.Unit">
                                    <option value="">Select Unit</option>
                                    </select>
                                    <label for="unit" class="form-label">Unit</label>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col col-md-3">
                                    <div class="form-check form-switch ">
                                    <input class="form-check-input can-delete" type="checkbox" id="available" name="darkmode"  asp-for="@Model.item.IsAvailable">
                                    <label for="name">Available</label>
                                    
                                    </div>
                                </div>
                                <div class="col col-md-3">
                                    <div class="form-check form-switch ">
                                    <input class="form-check-input can-delete" type="checkbox" id="default" name="darkmode" asp-for="@Model.item.DefaultTax" >
                                    <label for="name">DefaultTax</label>

                                    </div>
                                </div>
                                <div class="col col-md-3">
                                    <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="TaxPercentage" name="TaxPercentage" placeholder="TaxPercentage" asp-for="@Model.item.TaxPercentage">
                                    <label for="TaxPercentage">TaxPercentage</label>
                                    </div>
                                </div>
                                 <div class="col col-md-3">
                                    <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="ShortCode" name="ShortCode" placeholder="ShortCode" asp-for="@Model.item.Shortcode">
                                    <label for="ShortCode">ShortCode</label>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="form-floating mb-3">
                                <textarea class="form-control" id="Description" name="Description" 
                                placeholder="Description"  asp-for="@Model.item.Description"></textarea>
                                <label for="Description">Description</label>
                            </div>
                            </div>
                            <div class="row">
                                    <label for="name">Upload Image</label>
                                <div style="position: relative;">
                                <div class=" d-flex flex-col align-items-center justify-content-center  text-center border border-danger  p-3"
                                style="width: 100%;border-radius: 5px;">
                                <i class="fa-solid fa-cloud-arrow-up me-2"></i>
                                <div class="flex " style="color: rgb(109, 21, 21);">Drag And Drop or Browse Files</div>
                            </div>
                            <input type="file" id="filename" class="form-control "  name="ProfileImg" 
                                style="opacity: 0.0; position: absolute; top:0; left: 0; bottom: 0; right:0; width: 100%; height:100%;" />
                            </div>
                            </div>
                        </div>
                        <div class="col-2 col-md-3 col-sm-12" style="background-color:antiquewhite">
                            <div class="row">
                                 <div class="col p-2">
                                    <div class="form-floating mb-3">
                                    <select class="form-select" id="modifierGroup" name="modifierGroup"  >
                                    <option value="">Select Modifier Group(s)</option>
                                    </select>
                                    <label for="category" class="form-label">Modifier</label>
                                    </div>
                                </div>
                           </div>
                        </div>
                    </div>
                   </div>
                </div>
                <div class="modal-footer d-flex  align-items-center justify-content-end">
                <button type="submit" class="btn  me-2" style="background-color: rgba(9, 9, 172, 0.692);color:white">Add</button>
                <button type="button" class="btn" style="border-color:rgba(9, 9, 172, 0.692);  color:rgba(9, 9, 172, 0.692); background-color: white;"data-bs-dismiss="modal" aria-label="Close"     formnovalidate>Cancel</button>
                </div>
                </form>
            </div>
        </div>
    </div>
    <div class="modal" id="deleteItem">
        <div class="modal-dialog modal-dialog-centered ">
          <div class="modal-content">
    
            <div class="modal-body text-center">
              <img src="images/toppng.com-warning-icon-2400x2400.png" alt="Image" class="img-fluid me-2 "
              style="font: 30px; height: 80px;" class="">
              <h3>Are you sure you want to delete this user?</h3>
            <div class="modal-footer d-flex  align-items-center justify-content-center">
              <button type="button" class="btn btn-danger align-items center" data-bs-dismiss="modal">Yes</button>
              <button type="button" class="btn btn-primary align-items center" data-bs-dismiss="modal">No</button>
            </div>
          </div>
        </div>
      </div>
      </div>
<script>
      function fetch(pageNumber,pageSize){
        let selectedPage=$("#pageSize").val();
        let itemId=@(Model.items.Count>0?Model.items[0].CategoryId:0);
        if(@Model.items.Count>0){
            $.ajax({
                url:"/Menu/CategoryItems",
                type: "GET",
                data:{id:itemId,pageNumber:pageNumber,pageSize:pageSize,selectedPage:selectedPage},
                success:function(response){
                    $("#renderitems").html(response);
                    $("#pageSize").val(selectedPage);
                }
            });
        }
        } 

        function fetchModifiers(selectedCategory){
            let categoryId=selectedCategory.value;
            $.ajax({
                url:"/Menu/GetModifierGroups",
                type: "GET",
                data:{id:categoryId},
                success:function(data){
                $.each(data,function(i,item){       
                $("#modifierGroup").append(new Option(item.modifierGroupName,item.modifierGroupId));
                
            });
                }
            });
        }
</script>
